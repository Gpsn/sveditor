
<project>

	<property file="${basedir}/../etc/sveditor.info"/>
	<property file="${basedir}/../etc/sveditor_${version_type}.info"/>
	<property file="${basedir}/../etc/packages.properties"/>

	<condition property="is_win">
		<os family="windows"/>
	</condition>
	
	<condition property="eclipse_run_win_zip"
		value="${basedir}/../packages/${eclipse_run_win32_x86_64_zip}"
		else="${basedir}/../packages/${eclipse_run_win32_zip}">
		<os arch="amd64"/>
	</condition>

	<include file="${basedir}/../scripts/eclipse_utils.xml"/>
	
	<property name="sveditor_dir" value="${basedir}/sveditor"/>

	<target name="init">
		<delete dir="${basedir}/sveditor"/>
		<mkdir dir="${basedir}/sveditor"/>
	</target>

	<target name="collect">
		<ant antfile="${basedir}/../scripts/collect.xml" target="collect"/>
	</target>

	<target name="mk_host" depends="init,collect,mk_eclipse">
	</target>

	<target name="mk_eclipse" depends="linux_unpack_eclipse,windows_unpack_eclipse">
		<mkdir dir="${sveditor_dir}/zest"/>
		<unzip dest="${sveditor_dir}/zest" 
			src="${basedir}/../packages/${zest_zip}"/>
		<install installIU="org.eclipse.gef.feature.group,
			org.eclipse.draw2d.feature.group,
			org.eclipse.zest.feature.group"
			tag="AddZEST"
			repository="file://${sveditor_dir}/zest"
			eclipseHome="${sveditor_dir}/eclipse"
			dest="${sveditor_dir}/eclipse"/>
			
		<!-- Install SVEditor -->
		<mkdir dir="${sveditor_dir}/sve"/>
		<unzip dest="${sveditor_dir}/sve"
			src="${basedir}/../buildResult/sveditor-${version}.jar"/>
		<install installIU="net.sf.sveditor.feature.group"
			tag="AddSVE"
			repository="file://${sveditor_dir}/sve"
			eclipseHome="${sveditor_dir}/eclipse"
			dest="${sveditor_dir}/eclipse"/>
			
		<!-- Install pre-requisites for RCPTT -->
		<mkdir dir="${sveditor_dir}/orbit"/>
		<unzip dest="${sveditor_dir}/orbit"
			src="${basedir}/../packages/${eclipse_orbit_zip}"/>
			<!-- com.google.gwt.user,org.eclipse.orbit.category.google -->
		<install installIU="com.google.guava,com.google.inject,com.google.gson"
			tag="AddGoogle"
			repository="file://${sveditor_dir}/orbit"
			eclipseHome="${sveditor_dir}/eclipse"
			dest="${sveditor_dir}/eclipse"/>
			
		<mkdir dir="${sveditor_dir}/emf"/>	
		<unzip dest="${sveditor_dir}/emf"
			src="${basedir}/../packages/${emf_zip}"/>	
		<install installIU="org.eclipse.emf.databinding.feature.group,
							org.eclipse.emf.edit.feature.group,
							org.eclipse.xsd.edit.feature.group,
							org.eclipse.emf.edit.ui.feature.group,
							org.eclipse.emf.ecore.edit.feature.group,
							org.eclipse.emf.common.ui.feature.group"
			tag="AddEMF"
			repository="file://${sveditor_dir}/emf"
			eclipseHome="${sveditor_dir}/eclipse"
			dest="${sveditor_dir}/eclipse"/>

		<mkdir dir="${sveditor_dir}/emf_validation"/>	
		<unzip dest="${sveditor_dir}/emf_validation"
			src="${basedir}/../packages/${emf_validation_zip}"/>	
		<install installIU="org.eclipse.emf.validation.feature.group"
			tag="AddEMFValidation"
			repository="file://${sveditor_dir}/emf_validation"
			eclipseHome="${sveditor_dir}/eclipse"
			dest="${sveditor_dir}/eclipse"/>
				
		<mkdir dir="${sveditor_dir}/emf_transaction"/>	
		<unzip dest="${sveditor_dir}/emf_transaction"
			src="${basedir}/../packages/${emf_transaction_zip}"/>	
		<install installIU="org.eclipse.emf.transaction.feature.group"
			tag="AddEMFTransaction"
			repository="file://${sveditor_dir}/emf_transaction"
			eclipseHome="${sveditor_dir}/eclipse"
			dest="${sveditor_dir}/eclipse"/>
			
		<mkdir dir="${sveditor_dir}/rcptt"/>
		<unzip dest="${sveditor_dir}/rcptt"
			src="${basedir}/../packages/${rcptt_zip}"/>
		<install installIU="org.eclipse.rcptt.platform.feature.group"
			tag="AddRCPTT"
			repository="file://${sveditor_dir}/rcptt"
			eclipseHome="${sveditor_dir}/eclipse"
			dest="${sveditor_dir}/eclipse"/>			
		
		<mkdir dir="${sveditor_dir}/rcptt_runner"/>
		<unzip dest="${sveditor_dir}/rcptt_runner"
			src="${basedir}/../packages/${rcptt_runner_zip}"/>
	</target>
		
	
	<target name="linux_unpack_eclipse" unless="is_win">
	<!-- TODO -->
	</target>
	
	<target name="windows_unpack_eclipse" if="is_win">
		<unzip dest="${sveditor_dir}" src="${eclipse_run_win_zip}"/>
	</target>
</project>